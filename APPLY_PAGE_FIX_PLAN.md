# Apply Page — Fix Plan

## 1 · Current Status
Working
• Translation keys no longer render literally (all 28 keys now point to `locationsPage.applyPage.*`).  
• EN/NL strings visible **after** React hydrates.  
• Build passes for Apply page; fails only on unrelated After-School page.  
• Console shows correct sample translation text.

Not Working
• Server-side HTML for `/apply` is empty → still CSR only.  
• Some runtime console warnings/errors reported by QA (details pending).  
• Dutch copy may be incomplete in a few nested keys.  
• After-School page build error blocks CI.

---

## 2 · Suspected / Potential Issues
1. **SSR Suspense** – Apply page wrapped in dynamic/lazy import → prevents static pre-render.  
2. **Missing Dutch keys** – `nlTranslations` lacks 1-to-1 copy of the new apply keys.  
3. **Form validation messages** hard-coded in English.  
4. **After-School build crash** – unrelated but blocks pipeline; likely `.map()` on undefined data prop.  
5. **Legacy nested path** vs flat path inconsistency across codebase.

---

## 3 · Step-by-Step Debugging Approach
1. Reproduce in dev  
   a. `npm run dev` → open `/apply` & view-source (expect empty body).  
   b. Open browser console & network panel for runtime errors.

2. SSR Investigation  
   a. Search for `suspense`, `dynamic`, `lazy` in `app/apply/**`.  
   b. Temporarily remove/downgrade lazy imports; run `next build && next start`; check HTML again.

3. Dutch Coverage Audit  
   a. Diff `enTranslations.applyPage` vs `nlTranslations.applyPage`.  
   b. For any missing, duplicate key with Dutch copy (placeholder ok).

4. Runtime Error Log  
   a. Capture console stack traces, map to component lines.  
   b. Fix prop types / undefined checks.

5. CI Build Failure  
   a. Inspect `programs/after-school` page component; ensure `.map()` always receives array.

6. Regression Tests  
   a. Run supplied checklist (`apply-page-test-checklist.md`).  
   b. Snapshots: view-source EN & NL saved for comparison.

---

## 4 · Two Paths Forward

### Path A — Quick Fix (ship fast)
1. Keep current nested translation structure (`locationsPage.applyPage.*`).  
2. Add any missing Dutch keys.  
3. Convert heavy dynamic/Lazy imports to synchronous (`import ...`) just for Apply page hero + form → restores SSR.  
4. Patch After-School `.map()` null-guard.  
5. Merge & release hot-fix.

Pros: minimal code churn, safest/fastest deploy.  
Cons: translation nesting remains inconsistent; future maintenance messy.

### Path B — Clean Fix (Grok’s proposal)
1. **Refactor translations**  
   • Move `applyPage` block out of `locationsPage` ➜ flat like `aboutPage`.  
   • Update both `en` & `nl` files.  
2. **Revert code edits**  
   • Replace all `locationsPage.applyPage` references back to `applyPage.*` (script-able).  
3. Complete Dutch copy parity.  
4. Repeat SSR & build steps from Path A.  
5. Update `TRANSLATION_GUIDE.md` → “Keep flat structure for page keys.”

Pros: consistent key layout, easier grep/search, future-safe.  
Cons: touches many lines, requires careful testing.

---

## 5 · Priority Order

| P# | Action | Path A | Path B |
|----|--------|--------|--------|
| 1  | Fix After-School build crash (unblocks CI) | ✅ | ✅ |
| 2  | Ensure Dutch keys 100 % coverage          | ✅ | ✅ |
| 3  | Restore SSR for Apply page (remove Suspense/dynamic) | ✅ | ✅ |
| 4  | Decide on translation structure            | — | ✅ (move to flat) |
| 5  | Code refactor & scripts rollback           | — | ✅ |
| 6  | Final regression tests + Lighthouse        | ✅ | ✅ |
| 7  | Update docs (`TRANSLATION_GUIDE.md`)       | ✅ | ✅ |

Recommendation:  
• **Short-term** – execute Path A to get site stable.  
• **Immediately after** – tackle Path B in a dedicated refactor branch.

---  
Generated by Factory assistant — July 2025
